---
title: "Titanic Discovery"
output:
  html_document:
  df_print: paged
  html_notebook: default
  pdf_document: default
---

# First look into the Titanic dataset from Kaggle.

```{r}
library(tidyverse)
library(corrplot)
library(patchwork)

missing <-
  c(sum(is.na(train_titanic$Cabin)), sum(is.na(train_titanic$Age)))

train_titanic <- read_csv("train.csv", show_col_types = FALSE)
train_titanic_NA_drop <- train_titanic |>
  drop_na(Age) |>
  mutate(
    age_bracket = dplyr::case_when(
      Age <= 17.5              ~ "Child",
      Age >= 18 & Age <= 55.5  ~ "Adult",
      Age >= 56 & Age <= 100   ~ "Senior"
    )
  ) |>
  mutate(Pclass = recode(
    Pclass,
    "1" = "First",
    "2" = "Second",
    "3" = "Third"
  ))
```

### Importing the data

#### Missing Values
|     The data set includes 891 observations with 12 variables. 177 of the observations are missing age. For the time being these observations will be dropped as age could be a large factor in a passengers survival. Later more complex methods could be used in an effort to preserve these observations. <br />
  <br />
|     The data set also includes 687 missing cabin number values as well.  Cabin number could be useful to predict a passengers survival as it places a passenger spatially in relation to lifesaving equipment on board.  (i.e. a person with a cabin deep in the ship would have a harder time getting to muster stations during an emergency) However, with so many missing values cabin number will be left out of the analyses as dropping would lead to too few observations.<br />
  <br />
```{r}
p1 <-
  ggplot(train_titanic_NA_drop, aes(Survived, fill = Sex)) +
  geom_bar() +
  scale_x_continuous(breaks = c(0, 1),
                     label = c("Dead", "Alive")) +
  labs(
    subtitle = "By gender.",
    x = "",
    y = "",
    fill = "Gender"
  ) +
  theme_classic() +
  scale_fill_viridis_d() +
  theme(plot.title = element_text(face = "bold")) +
  theme(panel.background = element_rect(fill = "grey97")) +
  theme(plot.background = element_rect("grey97")) +
  theme(legend.background = element_rect("grey99"))

p2 <-
  ggplot(train_titanic_NA_drop, aes(Survived, fill = age_bracket)) +
  geom_bar() +
  scale_x_continuous(breaks = c(0, 1),
                     label = c("Dead", "Alive")) +
  labs(
    subtitle = "By age bracket.",
    fill = "Age Bracket",
    x = "",
    y = "",
  ) +
  theme_classic() +
  scale_fill_viridis_d() +
  theme(plot.title = element_text(face = "bold")) +
  theme(panel.background = element_rect(fill = "grey97")) +
  theme(plot.background = element_rect("grey97")) +
  theme(legend.background = element_rect("grey99"))

p3 <-
  ggplot(train_titanic_NA_drop, aes(Survived, fill = Pclass)) +
  geom_bar() +
  scale_x_continuous(breaks = c(0, 1),
                     label = c("Dead", "Alive")) +
  labs(
    subtitle = "By passenger class.",
    x = "",
    y = "",
    color = "Country",
    fill = "Ticket Class"
  ) +
  theme_classic() +
  scale_fill_viridis_d() +
  theme(plot.title = element_text(face = "bold")) +
  theme(panel.background = element_rect(fill = "grey97")) +
  theme(plot.background = element_rect("grey97")) +
  theme(legend.background = element_rect("grey99"))

wrap_plots(p1, p2, p3) +
  plot_annotation(title = "Outcome of Titanic passengers",
                  caption = "Source: train.csv, Kaggle") +
  plot_layout()
```

## Women and children first. - Birkenhead Drill

### What happened to the passengers? 

|     Looking at the breakdown of passengers on the Titanic we can see that of the survivors a larger proportion were Women.This indicates that the saying "women and children first" is at least half true in the case of the Titanic! To see if the other half of the Birkenhead drill is alto true we will now break down passengers by age bracket.(Young, Adult, Senior) <br />
<br />

|     By breaking the passengers down by three age brackets it is clear that adults were the largest group of people to survive, a larger proportion of children were also saved which indicates that the Birkenhead drill is mostly true. Seniors were the smallest proportion of survivors which could be explained by frailty and the ensuing melee during the sinking. <br />
<br />

|     When the passengers are broken down by the class of the passengers ticket. The higher the class of the passenger the higher chance they had of survival. This could be due to the fact that the rich and poor are treated differently. Spatial constraints could also explain why more third class passengers died. (ie. third class cabins were in deeper and lower parts of the ship which would have flooded first and would be hardest to get out of.) <br />
<br />

|     From these charts we can conclude that a passenger with the highest chances of survival would be woman passenger in first class. 

### Correlation Plot

```{r}
train_titanic_NA_drop_recode <- train_titanic_NA_drop |>
  mutate(Sex = recode(Sex, "male" = 0, "female" = 1)) |>
  mutate(Embarked = recode(
    Embarked,
    "C" = 0,
    "Q" = 1,
    "S" = 3
  )) |>
  mutate(Pclass = recode(
    Pclass,
    "First" = 1,
    "Second" = 2,
    "Third" = 3
  )) |>
  select(Survived,
         Pclass,
         Sex,
         Age,
         SibSp,
         Parch,
         Fare)

train_titanic_NA_drop_recode = cor(train_titanic_NA_drop_recode)
corrplot(
  train_titanic_NA_drop_recode,
  method = "number",
  addrect = 2,
  type = "upper",
  cl.pos = 'n',
  col = COL2('RdBu', 50),
  bg = 'grey90'
)
```
|     Looking at a correlation plot of the categorical variables, a linear correlation of variables based on survival outcome reinforces the findings in the bar charts.  Survival is negatively correlated with class, as the passenger class rose (ie. had a lower class ticket) their chances of survival would reduce.  Survival is positive correlated with Sex, 1 = female, 0 = male so women had a higher chance of survival in comparison to men.  Age, number of siblings and, parental status  all show a low correlation with survival.  The fare a passenger paid is positively correlated with survival, it could be seen as a different way of conveying similar information as in class. Looking at the the correlation of "fare" and "pclass", we can see a negative correlation which conforms to reality, generally a a passenger paid more for their ticket the higher their ticket class was.
<br />